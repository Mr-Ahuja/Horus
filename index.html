<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Horus — Video Room</title>
  <script type='text/javascript' src='scaledrone.min.js'></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 256 256' width='256' height='256' role='img' aria-label='Inverted white iris with off-center pupil'%3E%3Ccircle cx='128' cy='128' r='100' fill='none' stroke='%23fff' stroke-width='20'/%3E%3Ccircle cx='128' cy='128' r='50' fill='none' stroke='%23fff' stroke-width='16'/%3E%3Ccircle cx='140' cy='120' r='16' fill='%23fff'/%3E%3C/svg%3E">
  <script>window.ENV = window.ENV || {};</script>
  <script src="env.js" defer></script>
  <style>
    :root {
      --bg: #0b0f14;
      --panel: #121821;
      --text: #e6eef8;
      --muted: #95a3b8;
      --accent: #2e8cff;
      --danger: #ff4d4f;
      --success: #29c26a;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; background: var(--bg); color: var(--text); font-family: Roboto, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; touch-action: manipulation; }
    .app {
      position: relative;
      width: 100%;
      min-height: 100dvh;
      overflow: hidden;
      display: grid;
      grid-template-rows: auto 1fr auto;
    }
    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: calc(8px + env(safe-area-inset-top)) 14px 10px 14px;
      background: linear-gradient(180deg, rgba(0,0,0,0.35), rgba(0,0,0,0));
      z-index: 3;
      }
    .room {
      display: flex; gap: 10px; align-items: center;
      font-weight: 500;
    }
    .badge { padding: 4px 10px; border-radius: 999px; font-size: 12px; background: var(--panel); color: var(--muted); }
    .status { padding: 4px 10px; border-radius: 999px; font-size: 12px; background: var(--panel); color: var(--muted); }
    .status.ok { color: var(--success); }
    .status.warn { color: #f5a524; }
    .status.err { color: var(--danger); }
    .btn { cursor: pointer; border: 1px solid #1e2733; background: #0f151d; color: var(--text); padding: 12px 14px; border-radius: 12px; font-size: 15px; transition: 0.15s ease; display: inline-flex; align-items: center; gap: 8px; min-height: 44px; }
    .btn:hover { border-color: #2a3545; background: #131b26; }
    .btn.primary { background: var(--accent); border-color: var(--accent); color: white; }
    .btn.danger { background: var(--danger); border-color: var(--danger); color: white; }
    .videos { position: relative; width: 100%; height: 100%; background: #000; overflow: hidden; }
    .remoteVideo { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; }
    .localVideo { position: absolute; bottom: 16px; right: 16px; width: min(30vw, 220px); aspect-ratio: 1.618/1; border-radius: 12px; box-shadow: 0 8px 30px rgba(0,0,0,.4); border: 1px solid #1c2430; background: #000; object-fit: cover; z-index: 3; }
    .controls { display: flex; gap: 10px; align-items: center; justify-content: center; padding: 10px; z-index: 3; background: linear-gradient(0deg, rgba(0,0,0,0.35), rgba(0,0,0,0)); position: sticky; bottom: 0; padding-bottom: calc(10px + env(safe-area-inset-bottom)); }
    .selects { display: flex; gap: 8px; align-items: center; }
    select { background: #0f151d; color: var(--text); border: 1px solid #1e2733; border-radius: 8px; padding: 6px 10px; }
    .helper { position: absolute; left: 50%; top: 50%; transform: translate(-50%,-50%); text-align: center; color: var(--muted); font-size: 14px; z-index: 1; }
    @media (max-width: 640px) {
      .grid { grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 8px; }
      .tile { border-radius: 10px; }
      .actions { display: none; }
      .selects { display: none; }
      .room { gap: 6px; }
      .status, .badge { font-size: 11px; }
      .btn { padding: 12px; font-size: 14px; }
    }

    /* Landing (constellations) */
    .landing { position: fixed; inset: 0; background: radial-gradient(1200px 800px at 70% 20%, #152030 0%, #0b0f14 60%); display: grid; place-items: center; z-index: 10; }
    .landing.hidden { display: none; }
    #stars { position: absolute; inset: 0; width: 100%; height: 100%; }
    .hero { position: relative; z-index: 1; display: flex; flex-direction: column; align-items: center; gap: 16px; text-align: center; padding: 24px; background: rgba(10,14,20,0.45); border: 1px solid #1f2a38; border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.35); }
    .hero h1 { margin: 0; font-size: 28px; letter-spacing: 0.5px; }
    .cta { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; }
    .btn.mellange { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #0b0f14; border-color: #ffffff22; }
    .btn.ghost { background: transparent; border-color: #ffffff33; color: var(--text); }
    .stack { display: grid; gap: 8px; margin-top: 8px; }
    .stack input { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #1e2733; background: #0f151d; color: var(--text); min-height: 44px; }
    .joinbar { display: grid; grid-template-columns: 1fr auto; gap: 8px; align-items: center; margin-top: 8px; }
    .joinbar input { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #1e2733; background: #0f151d; color: var(--text); min-height: 44px; }
    .icon-btn { display: inline-flex; align-items: center; justify-content: center; width: 48px; height: 48px; border-radius: 12px; border: 1px solid #1e2733; background: #0f151d; color: var(--text); }
    @media (max-width: 520px) { .stack { gap: 8px; } }

    /* Duo mode (one remote) */
    .mode-duo .grid { display: block; }
    .mode-duo .tile { display: none; }
    .mode-duo .tile.remote-active { display: block; position: absolute; inset: 10px; border-radius: 12px; }
    .mode-duo #tile-self { display: block; position: absolute; bottom: 16px; right: 16px; width: min(30vw, 220px); aspect-ratio: 1.618/1; border-radius: 12px; z-index: 3; }

    /* Name Modal */
    .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 20; }
    .modal.show { display: flex; }
    .modal-card { background: rgba(10,14,20,0.95); border: 1px solid #1f2a38; padding: 20px; border-radius: 14px; width: min(92vw, 420px); display: grid; gap: 10px; }
    .modal-card h3 { margin: 0 0 6px; font-weight: 600; }
    .modal-card input { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #1e2733; background: #0f151d; color: var(--text); }
  </style>
</head>

<body>
  <div id="nameModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="nameModalTitle">
    <div class="modal-card">
      <h3 id="nameModalTitle">Enter your name to join</h3>
      <input id="modalName" placeholder="Your name" />
      <button id="modalJoinBtn" class="btn primary">Join Call</button>
    </div>
  </div>
  <div id="landing" class="landing">
    <canvas id="stars"></canvas>
    <div class="hero">
      <div class="logo" aria-hidden="true">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="96" height="96" style="opacity:.7;">
          <!-- variant without white outer fill, light strokes for contrast -->
          <circle cx="128" cy="128" r="100" fill="none" stroke="#e6eef8" stroke-width="16"/>
          <circle cx="128" cy="128" r="50" fill="none" stroke="#e6eef8" stroke-width="12"/>
          <circle cx="140" cy="120" r="14" fill="#e6eef8"/>
        </svg>
      </div>
      <h1>Horus Calls</h1>
      <div class="cta">
        <button id="startRoomBtn" class="btn mellange"><span class="material-icons" style="font-size:18px">auto_awesome</span>Start Room</button>
      </div>
      <div class="stack">
        <input id="nameInput" placeholder="Your name" />
        <input id="roomTitleInput" placeholder="Room name (optional)" />
        <div class="joinbar">
          <input id="roomInput" placeholder="Enter room code" />
          <button id="goBtn" class="icon-btn" aria-label="Join"><span class="material-icons">arrow_forward</span></button>
        </div>
      </div>
    </div>
    <div style="position:absolute;bottom:16px;left:0;right:0;text-align:center;font-size:12px;color:#9fb3cc">Credits: Horus Vision by Preetam Ahuja</div>
  </div>
  <div class="app">
    <div class="topbar">
      <div class="room">
        <span class="badge">Room</span>
        <span id="roomId"></span>
        <span id="roomTitle" class="badge"></span>
        <span id="connStatus" class="status">initializing…</span>
        <span class="badge" id="participants">1</span>
      </div>
      <div class="actions">
        <button id="copyLinkBtn" class="btn"><span class="material-icons" style="font-size:18px">link</span>Copy Link</button>
      </div>
    </div>
    <div class="videos">
      <video id="remoteVideo" class="remoteVideo" autoplay playsinline></video>
      <video id="localVideo" class="localVideo" autoplay muted playsinline></video>
    </div>
    <div class="controls">
      <button id="toggleMicBtn" class="btn" aria-pressed="false"><span class="material-icons" style="font-size:18px">mic</span><span>Mute</span></button>
      <button id="toggleCamBtn" class="btn" aria-pressed="false"><span class="material-icons" style="font-size:18px">videocam</span><span>Stop</span></button>
      <button id="hangupBtn" class="btn danger"><span class="material-icons" style="font-size:18px">call_end</span><span>End</span></button>
      <div class="selects">
        <label for="audioIn">Mic</label>
        <select id="audioIn"></select>
        <label for="videoIn">Camera</label>
        <select id="videoIn"></select>
      </div>
    </div>
  </div>
  <script src="script.js"></script>
</body>

</html>
